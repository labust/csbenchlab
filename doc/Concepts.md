

# Environment

The central concept for evaluating the quality of controllers for dynamical system control is called an Environment.
The Environment is manifested as a ".slx" simulink scheme that is autogenerated and constructed by a "config.json"
file as a recipe. An example of the Environment is shown in Figure %TODO: dodaj sliku

The Environment is composed from four integral parts:

1) System
    - Defined as a Matlab Class (that inherits from DynSystem) or a Simulink block to be used as a System block
    - The system block is replicated N times, where N is the number of controllers in the Environment
    - The Environment ensures that each controller has its own, correctly configured System instance
    - Changes to the System instances are not permited (and not possible) in the Environment.
    - Modification of the System definition is recommended by using user functions
        %TODO: create_environment, update_environment

2) Controllers
    - Defined as a list of Matlab objects of type TODO: (Link) ControllerOptions
    - A Controller is realized as a Matlab Class (that inherits from Controller) or a Simulink block to be used as a Controller block
    - A Controller can be composed of multiple subcontrollers, each controlling a subset of the system DOFs
    - Each controller is configured separately
    - TODO: (Link) add_controller, remove_controller

3) Scenario definition file
    - Realized as a list of Scenario structures or the path to the ".mat" file containing Scenario structures
    - A Scenario represents one simulation instance for the Environment
    - A Scenario defines a TODO: (Link) Reference, system parameters and the system initial condition
    - TODO: (Link) load_references, edit_references, load_scenarios, save_scenarios

4) Plots
    - Realized as a list of Plot structures or the path to the ".mat" file containing Plot structures
    - A Plot defines options for plotting the result data after the simulation is successful
    - TODO: (Link) load_plots, save_plots


# Scenario

A Scenario defines the specific conditions under which the System operates within an Environment.
For example, a Scenario might specify different initial states, system parameters,
or external disturbances to reflect various real-world operating conditions.
This allows for comprehensive testing of how controllers respond to a wide range of situations.

Scenario definition can be found in TODO: Link



# Controller

A Controller refers to a control algorithm implemented as a Matlab Class or a Simulink block.
The goal of the Controller is to govern the behavior of a dynamical system by processing its measurements
and generating appropriate control signals. To be able to use various Controllers in the Environment,
all Controllers should have the predefined generic form. A guide for custom Controller implementation is
shown bellow.

The Controller can be added to the Environment by using the TODO: link add_controller function. The controller
definition can be found at TODO: link ControllerOptions


## Matlab Class implementation

The Controller realized through a Matlab Class can be used both in Matlab and with Simulink and is recommended
way of implementing a new Controller. By defining the custom Controller information, the Controller simulink block
will be autogenerated in the '_sim_lib_.slx' library and will be ready to use in Simulink.

Each Matlab Class Controller should have the following form:

```
    TODO: links
    ParamDescriptor
    ParamSet
    LogEntry
    RegistryInfo
    IOArgiment
```


```
classdef Controller1 < Controller

    properties (Constant)
        param_description = ParamSet( ...
                ParamDescriptor("p1", true), ...
                ParamDescriptor("p2", true), ...
        );


        registry_info = RegistryInfo("Controller1", true);

        log_description = {
            LogEntry('x1'), ...
            LogEntry('x2'), ...
            LogEntry('x3')
        };

        io_description = {
            IOArgument('input', "in1", 5)
        };
    end



    methods (Static)
        function data = create_data_model(params)
            data.x1 = zeros(params.p1, 1);
            data.x2 = zeros(params.p2, 1);
            data.x3 = 3;
            data.x4 = 5;
        end
    end

    methods

        function this = Controller1(varargin)
            this@Controller(varargin);
        end

        function this = on_configure(this)
            % Called only once at the start of the simulation
            this.data.x3 = 5;
        end

        function [this, u] = on_step(this, y_ref, y, dt, trajectory)
            % Called every step of the simulation
        end

    end
end

```

### Explanation

Matlab and Simulink require the types to be static while the simulation is running. To ensure that
and to speed up the compilation times, we define the struct named `data` that is required for every
Matlab Class Controller. This struct defines the controller data model. It contains and persists the data
over time and is accesible through `this.data`.

We require the implementation of the function `create_data_model` where the data struct is first initialized.
Make sure that you initialize all the values you plan to use in the controller with the correct types
and dimensions. You can read more about this in the TODO: link na advanced


The Matlab Class Controller offeres four constant properties to be implemented:

1) param_description
    - defines the parameter set for this controller
2) registry_info
    - register this controller for Simulink autogeneration and give it a name
    - recommended is to use the same name as the Matlab Class name
3) log_description
    - define the names of the fields in the `data` struct you want to log
    - only logged data can be accessible when the simulation ends
    - listing names that are not present in the `data` struct after the
      `create_data_model` function is called will result in an error
4) io_description
    - if your controller requires additional inputs, you can specify them here



## Simulink implementation

The Controller realized as a Simulink block should have the following form:

1) Inputs
    1) (reference) - current reference value for the system states
    2) (measurement) - current system measured value of the system states
    3) (dt) - time difference between control steps

2) Outputs
    1) (control) - the control value (input to the dynamical system)
    1) (log (optional)) - logging data of the controller

Any other Controller definition may result in an unwanted behavior.
We recommend using Subsystem block for Simulink Controller implementation.

An example of the controller TODO:

